#!/usr/bin/env bash
WDIR="$(cygpath -u "${WINDIR}")"
W32DIR="$WDIR/SysWOW64"
W64DIR="$WDIR/System32"
OLD_PWD="$PWD"
WORKING="$(mktemp -d)"
VERSION="2018-01-12-450f3c9b459d128135abb5bbd4fa0508fe26bfae"
Z3_REPO_URL="https://github.com/batfish/z3"
Z364_ZIP_URL="${Z3_REPO_URL}/releases/download/z3-${VERSION}/z3-${VERSION}-x64-win.zip"
Z364_ZIP="$(basename "${Z364_ZIP_URL}")"
Z364_DIR="$(basename "${Z364_ZIP}" .zip)"
Z332_ZIP_URL="${Z3_REPO_URL}/releases/download/z3-${VERSION}/z3-${VERSION}-x86-win.zip"
Z332_ZIP="$(basename "${Z332_ZIP_URL}")"
Z332_DIR="$(basename "${Z332_ZIP}" .zip)"
set -x
set -e
cd "$WORKING" || exit 1
wget "${Z364_ZIP_URL}"
unzip "${Z364_ZIP}"
cp "${Z364_DIR}/bin/libz3.dll" "${W64DIR}"
getfacl "${W64DIR}/msvcr110.dll" | setfacl -f - "${W64DIR}/libz3.dll"
cp "${Z364_DIR}/bin/libz3java.dll" "${W64DIR}"
getfacl "${W64DIR}/msvcr110.dll" | setfacl -f - "${W64DIR}/libz3java.dll"
cp "${Z364_DIR}/bin/libz3.dll" "${W64DIR}/z3.dll"
getfacl "${W64DIR}/msvcr110.dll" | setfacl -f - "${W64DIR}/z3.dll"
cp "${Z364_DIR}/bin/libz3java.dll" "${W64DIR}/z3java.dll"
getfacl "${W64DIR}/msvcr110.dll" | setfacl -f - "${W64DIR}/z3java.dll"
cp "${Z364_DIR}/bin/Microsoft.Z3.dll" "${W64DIR}/"
getfacl "${W64DIR}/msvcr110.dll" | setfacl -f - "${W64DIR}/Microsoft.Z3.dll"
wget "${Z332_ZIP_URL}"
unzip "${Z332_ZIP}"
cp "${Z332_DIR}/bin/libz3.dll" "${W32DIR}/"
getfacl "${W32DIR}/msvcr110.dll" | setfacl -f - "${W32DIR}/libz3.dll"
cp "${Z332_DIR}/bin/libz3java.dll" "${W32DIR}/"
getfacl "${W32DIR}/msvcr110.dll" | setfacl -f - "${W32DIR}/libz3java.dll"
cp "${Z332_DIR}/bin/libz3.dll" "${W32DIR}/z3.dll"
getfacl "${W32DIR}/msvcr110.dll" | setfacl -f - "${W32DIR}/z3.dll"
cp "${Z332_DIR}/bin/libz3java.dll" "${W32DIR}/z3java.dll"
getfacl "${W32DIR}/msvcr110.dll" | setfacl -f - "${W32DIR}/z3java.dll"
cp "${Z332_DIR}/bin/Microsoft.Z3.dll" "${W32DIR}/"
getfacl "${W32DIR}/msvcr110.dll" | setfacl -f - "${W32DIR}/Microsoft.Z3.dll"
cd "${OLD_PWD}" || exit 1
rm -rf "${WORKING}" || exit 1

