package org.batfish.vendor.cisco_aci.representation;

import com.fasterxml.jackson.annotation.JsonInclude;
import com.fasterxml.jackson.annotation.JsonProperty;
import java.io.Serializable;
import java.util.Objects;
import javax.annotation.Nullable;

/**
 * Data class representing a security finding from ACI contract analysis.
 *
 * <p>Security findings are generated by {@link AciSecurityAnalyzer} when analyzing ACI contracts
 * for overly permissive or misconfigured security rules. Each finding includes severity level,
 * category, description, and actionable recommendations.
 */
@JsonInclude(JsonInclude.Include.NON_NULL)
public class SecurityFinding implements Serializable {

  private static final long serialVersionUID = 1L;

  /** Severity levels for security findings. */
  public enum Severity {
    /** High severity issues that should be addressed immediately (e.g., any-any rules). */
    HIGH,
    /** Medium severity issues that should be reviewed and addressed (e.g., broad port ranges). */
    MEDIUM,
    /** Low severity issues that represent best practice violations (e.g., missing deny rules). */
    LOW
  }

  /** Categories of security findings. */
  public enum Category {
    /** Filter matches all traffic (any protocol, any port). */
    ANY_ANY,
    /** Filter allows traffic from any source to any destination. */
    OVERLY_PERMISSIVE,
    /** Contract has only allow rules with no deny restrictions. */
    MISSING_DENY,
    /** Contract has implicit allow at the end (no explicit deny). */
    IMPLICIT_ALLOW,
    /** TCP/UDP protocol without port restrictions. */
    UNRESTRICTED_PROTOCOL,
    /** Port range covers entire valid range (e.g., 1-65535). */
    BROAD_PORT_RANGE
  }

  @JsonProperty("severity")
  private final Severity _severity;

  @JsonProperty("category")
  private final Category _category;

  @JsonProperty("description")
  private final String _description;

  @JsonProperty("contractName")
  private final @Nullable String _contractName;

  @JsonProperty("filterName")
  private final @Nullable String _filterName;

  @JsonProperty("entryName")
  private final @Nullable String _entryName;

  @JsonProperty("tenantName")
  private final @Nullable String _tenantName;

  @JsonProperty("recommendation")
  private final String _recommendation;

  /**
   * Creates a new security finding.
   *
   * @param severity The severity level of the finding
   * @param category The category of the security issue
   * @param description Human-readable description of the issue
   * @param contractName The name of the contract containing the issue (if applicable)
   * @param filterName The name of the filter containing the issue (if applicable)
   * @param entryName The name of the filter entry containing the issue (if applicable)
   * @param tenantName The name of the tenant containing the issue (if applicable)
   * @param recommendation Actionable recommendation to fix the issue
   */
  public SecurityFinding(
      Severity severity,
      Category category,
      String description,
      @Nullable String contractName,
      @Nullable String filterName,
      @Nullable String entryName,
      @Nullable String tenantName,
      String recommendation) {
    _severity = severity;
    _category = category;
    _description = description;
    _contractName = contractName;
    _filterName = filterName;
    _entryName = entryName;
    _tenantName = tenantName;
    _recommendation = recommendation;
  }

  public Severity getSeverity() {
    return _severity;
  }

  public Category getCategory() {
    return _category;
  }

  public String getDescription() {
    return _description;
  }

  public @Nullable String getContractName() {
    return _contractName;
  }

  public @Nullable String getFilterName() {
    return _filterName;
  }

  public @Nullable String getEntryName() {
    return _entryName;
  }

  public @Nullable String getTenantName() {
    return _tenantName;
  }

  public String getRecommendation() {
    return _recommendation;
  }

  @Override
  public boolean equals(Object o) {
    if (this == o) {
      return true;
    }
    if (!(o instanceof SecurityFinding)) {
      return false;
    }
    SecurityFinding that = (SecurityFinding) o;
    return _severity == that._severity
        && _category == that._category
        && Objects.equals(_description, that._description)
        && Objects.equals(_contractName, that._contractName)
        && Objects.equals(_filterName, that._filterName)
        && Objects.equals(_entryName, that._entryName)
        && Objects.equals(_tenantName, that._tenantName)
        && Objects.equals(_recommendation, that._recommendation);
  }

  @Override
  public int hashCode() {
    return Objects.hash(
        _severity,
        _category,
        _description,
        _contractName,
        _filterName,
        _entryName,
        _tenantName,
        _recommendation);
  }

  @Override
  public String toString() {
    return String.format(
        "SecurityFinding{severity=%s, category=%s, description='%s', contract='%s', filter='%s', "
            + "entry='%s', tenant='%s', recommendation='%s'}",
        _severity,
        _category,
        _description,
        _contractName,
        _filterName,
        _entryName,
        _tenantName,
        _recommendation);
  }
}
