package org.batfish.vendor.cisco_aci.representation;

import com.fasterxml.jackson.annotation.JsonInclude;
import com.fasterxml.jackson.annotation.JsonProperty;
import java.io.Serializable;
import java.util.Objects;
import javax.annotation.Nullable;

/**
 * Data model class representing a reachability finding for ACI EPG analysis.
 *
 * <p>Reachability findings are generated by the {@link AciReachabilityAnalyzer} and represent
 * issues or validation results related to EPG communication, contract configuration, and fabric
 * attachment. Each finding includes a severity level, category, affected EPGs, description, and
 * recommendation.
 */
@JsonInclude(JsonInclude.Include.NON_NULL)
public class ReachabilityFinding implements Serializable {

  /** Severity levels for reachability findings. */
  public enum Severity {
    /** High severity issues that will prevent communication (e.g., missing contracts) */
    HIGH,
    /** Medium severity issues that may cause unexpected behavior */
    MEDIUM,
    /** Low severity issues that should be reviewed */
    LOW,
    /** Informational findings for awareness */
    INFO
  }

  /** Categories of reachability findings. */
  public enum Category {
    /** No contract exists between EPGs in different bridge domains */
    NO_CONTRACT,
    /** EPG has no provider or consumer relationships (orphaned) */
    ORPHANED,
    /** EPG is not attached to any path in the fabric */
    MISSING_PATH,
    /** Contract references non-existent provider or consumer EPG */
    INVALID_CONTRACT_REFERENCE,
    /** EPGs in same bridge domain can communicate without contract */
    SAME_BD_COMMUNICATION,
    /** Contract exists but no filter rules defined */
    EMPTY_CONTRACT,
    /** General informational finding */
    INFO
  }

  @JsonProperty("severity")
  private Severity _severity;

  @JsonProperty("category")
  private Category _category;

  @JsonProperty("sourceEpg")
  private @Nullable String _sourceEpg;

  @JsonProperty("destEpg")
  private @Nullable String _destEpg;

  @JsonProperty("description")
  private String _description;

  @JsonProperty("recommendation")
  private @Nullable String _recommendation;

  @JsonProperty("contract")
  private @Nullable String _contract;

  public ReachabilityFinding(
      Severity severity, Category category, String description, @Nullable String recommendation) {
    _severity = severity;
    _category = category;
    _description = description;
    _recommendation = recommendation;
  }

  public Severity getSeverity() {
    return _severity;
  }

  public void setSeverity(Severity severity) {
    _severity = severity;
  }

  public Category getCategory() {
    return _category;
  }

  public void setCategory(Category category) {
    _category = category;
  }

  public @Nullable String getSourceEpg() {
    return _sourceEpg;
  }

  public void setSourceEpg(@Nullable String sourceEpg) {
    _sourceEpg = sourceEpg;
  }

  public @Nullable String getDestEpg() {
    return _destEpg;
  }

  public void setDestEpg(@Nullable String destEpg) {
    _destEpg = destEpg;
  }

  public String getDescription() {
    return _description;
  }

  public void setDescription(String description) {
    _description = description;
  }

  public @Nullable String getRecommendation() {
    return _recommendation;
  }

  public void setRecommendation(@Nullable String recommendation) {
    _recommendation = recommendation;
  }

  public @Nullable String getContract() {
    return _contract;
  }

  public void setContract(@Nullable String contract) {
    _contract = contract;
  }

  @Override
  public boolean equals(Object o) {
    if (this == o) {
      return true;
    }
    if (!(o instanceof ReachabilityFinding)) {
      return false;
    }
    ReachabilityFinding that = (ReachabilityFinding) o;
    return _severity == that._severity
        && _category == that._category
        && Objects.equals(_sourceEpg, that._sourceEpg)
        && Objects.equals(_destEpg, that._destEpg)
        && Objects.equals(_description, that._description)
        && Objects.equals(_recommendation, that._recommendation)
        && Objects.equals(_contract, that._contract);
  }

  @Override
  public int hashCode() {
    return Objects.hash(
        _severity, _category, _sourceEpg, _destEpg, _description, _recommendation, _contract);
  }

  @Override
  public String toString() {
    return String.format(
        "ReachabilityFinding{severity=%s, category=%s, sourceEpg='%s', destEpg='%s', "
            + "description='%s', recommendation='%s', contract='%s'}",
        _severity, _category, _sourceEpg, _destEpg, _description, _recommendation, _contract);
  }

  /** Builder pattern for creating ReachabilityFinding instances with a fluent API. */
  public static class Builder {
    private Severity _severity;
    private Category _category;
    private String _description;
    private String _recommendation;
    private String _sourceEpg;
    private String _destEpg;
    private String _contract;

    public Builder(Severity severity, Category category, String description) {
      _severity = severity;
      _category = category;
      _description = description;
    }

    public Builder setSourceEpg(String sourceEpg) {
      _sourceEpg = sourceEpg;
      return this;
    }

    public Builder setDestEpg(String destEpg) {
      _destEpg = destEpg;
      return this;
    }

    public Builder setRecommendation(String recommendation) {
      _recommendation = recommendation;
      return this;
    }

    public Builder setContract(String contract) {
      _contract = contract;
      return this;
    }

    public ReachabilityFinding build() {
      ReachabilityFinding finding =
          new ReachabilityFinding(_severity, _category, _description, _recommendation);
      finding.setSourceEpg(_sourceEpg);
      finding.setDestEpg(_destEpg);
      finding.setContract(_contract);
      return finding;
    }
  }
}
